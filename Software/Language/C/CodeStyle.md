# 代码规范

每位程序员都有自己的编程风格，因为每位程序员都有自己的学习过程，就象每个人的个性一样，
所以编程风格是风彩各异、百花齐放；而从软件工程理论、实践来看，现代软件是多人合作的结晶，
编程风格是否统一，直接关系到软件项目的可读性、可维护性、培训，继而对软件开发成本有着直接的关系，
编程风格一致，软件项目易培训，其它人员接手老项目的时间缩短，便于程序员之间的交流。编程风格混乱，
则其它人员接手老项目时间增长，同时随着项目的不断开发，项目或者单个源程序文件内有着多种编程风格，
这样不利于整个项目的开展以及程序员之间的交流。甚至影响整个公司的形象。

## 基本要求
* 程序结构清析，简单易懂，单个函数的程序行数不得超过200行
* 打算干什么，要简单，直接了当，代码精简，避免垃圾程序
* 尽量使用标准库函数和公共函数
* 不要随意定义全局变量，尽量使用局部变量
* 使用括号以避免二义性(附一)

## 文档完整性要求
* 项目下的所有源文件、库文件、头文件、资源文件等要全部放在项目文件夹及相应子文件夹下

## 可读性要求
* 可读性第一，效率第二
* 保持注释与代码完全一致
* 每个源程序文件，都有文件头说明，说明规格见规范
* 每个函数，都有函数头说明，说明规格见规范
* 主要变量（结构、联合、类或对象）定义或引用时，注释能反映其含义
* 常量定义（DEFINE）有相应说明
* 处理过程的每个阶段都有相关注释说明
* 在典型算法前都有注释
* 循环、分支层次不要超过五层
* 注释可以与语句在同一行，也可以在上行
* 空行和空白字符也是一种特殊注释
* 代码行最大长度宜控制在70至80个字符以内
* 尽量避免在注释中使用缩写，特别是不常用的缩写
* 一目了然的语句不加注释
* 注释的作用范围可以为：定义、引用、条件分支以及一段代码
* 注释行数（不包括程序头和函数头说明部份）应占总行数的 1/5 到 1/3 
* 长表达式要在低优先级操作符处拆分成新行，操作符放在新行之首（以便突出操作符）。拆分出的新行要进行适当的缩进，使排版整齐，语句可读。（附五）

## 结构化要求
* 禁止出现两条等价的支路
* 最好不用GOTO语句
* 用if语句来强调只执行两组语句中的一组。禁止else goto和else return
* 用 case 实现多路分支
* 避免从循环引出多个出口
* 函数只有一个出口
* 建议不使用条件赋值语句(变量名=条件表达式？表达式T：表达式F) （附二）
* 避免不必要的分支
* 不要轻易用条件分支去替换逻辑表达式（附三）
* 尽量的少用递归调用
* 函数的功能要单一，不要设计多用途的函数。

## 正确性与容错性要求
* 程序首先是正确，其次是优美
* 无法证明你的程序没有错误，因此在编写完一段程序后，应先回头检查
* 改一个错误时可能产生新的错误，因此在修改前首先考虑对其它程序的影响
* 所有变量在调用前必须被初始化（特别要注意通过动态内存分配产生的变量的初始化）
* 对所有的用户输入，必须进行合法性检查
* 不要比较浮点数的相等，如： 10.0 * 0.1 == 1.0，而应该是比较两者差值小于误差允许值（如 fabs(10.0*0.1 –1.0)<1e-5）
* 程序与环境或状态发生关系时，必须主动去处理发生的意外事件，如文件能否逻辑锁定、打印机是否联机等
* 单元测试也是编程的一部份，提交联调测试的程序必须通过单元测试
* Case条件语句应加入default

## 可重用性要求
* 重复使用的完成相对独立功能的算法或代码应抽象为公共控件或类
* 公共控件或类应考虑OO思想，减少外界联系，考虑独立性或封装性

## 版本维护要求
版本封存以后的修改一定要将老语句用“//”、“/* */”等符号封闭，
而不能自行删除或修改，并要在文件头部及函数的修改记录中加以记录。
建立change.log文件，记录每次新版本发布所做的功能修改、功能增加，以及bug的排除情况

例：
u'nSP IDE ver 1.4.7
- Merge SPGC IDE 

u'nSP IDE ver 1.4.6 
- Dump memory change to dump file 
- Seperate declare resource in two files, resource。inc resource。asm
- Resource can output start or end label
- Resource group management
- Naming resource ID add file extension part 
- Resolve the conflict between make and antvirus 
- Xlib16 in user interface
- Add SPT6601, SPT6602 Body 
- Merge win95/nt/98/2000 in one install file

## 其它C语言代码规范参考资料

* [GNU Coding Standards(html)](resource/GNUCodingStandards.html)
* [GNU Coding Standards(text)](resource/GNUCodingStandards.txt)
* [Linux kernel coding style](resource/LinuxCodingStyle.txt)
* [有规范的代码示例](resource/server.c)